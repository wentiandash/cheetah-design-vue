{"version":3,"file":"index.js","sources":["../../../../../src/components/scrollbar/src/index.tsx"],"sourcesContent":["import { computed, defineComponent, ref, watchEffect } from 'vue'\nimport type { ExtractPropTypes, PropType } from 'vue'\nimport { useExpose } from '../../../composables'\n\nexport type ScrollbarProps = ExtractPropTypes<typeof scrollbarProps>\nexport interface ScrollbarInstance extends HTMLElement {\n  scrollto(options: ScrollToOptions): void\n}\n\nconst scrollbarProps = {\n  height: Number,\n  minThumbSize: {\n    type: Number,\n    default: 20,\n  },\n  behavior: {\n    type: String as PropType<ScrollBehavior>,\n    default: 'auto',\n  },\n}\nexport default defineComponent({\n  name: 'Scrollbar',\n  props: scrollbarProps,\n  emits: ['scroll'],\n  setup(props, { slots, emit }) {\n    let beforeScrollTop = 0\n    let beforeScrollLeft = 0\n    const translateX = ref(0)\n    const translateY = ref(0)\n    const thumbWidth = ref(0)\n    const thumbHeight = ref(0)\n    const isShowBar = ref(false)\n    const isShowBarX = ref(false)\n    const isShowBarY = ref(false)\n    const wrpperEl = ref<HTMLElement>()\n    const thumbXEl = ref<HTMLElement>()\n    const thumbYEl = ref<HTMLElement>()\n\n    useExpose({\n      scrollto(options: ScrollToOptions) {\n        wrpperEl.value?.scrollTo(options)\n      },\n    })\n\n    const scrollbarHeight = computed(() => {\n      if (props.height) {\n        return {\n          height: `${props.height}px`,\n        }\n      }\n      return {\n        height: '100%',\n      }\n    })\n\n    const updateThumb = () => {\n      if (!wrpperEl?.value)\n        return\n\n      thumbHeight.value = Math.max(\n        wrpperEl.value.offsetHeight ** 2 / wrpperEl.value.scrollHeight,\n        props.minThumbSize,\n      )\n      thumbWidth.value = Math.max(\n        wrpperEl.value.offsetWidth ** 2 / wrpperEl.value.scrollWidth,\n        props.minThumbSize,\n      )\n    }\n\n    const scrollX = () => {\n      wrpperEl.value?.scrollTo({\n        left: wrpperEl.value.scrollWidth * (translateX.value / wrpperEl.value.offsetWidth),\n        behavior: props.behavior,\n      })\n    }\n\n    const scrollY = () => {\n      wrpperEl.value?.scrollTo({\n        top: wrpperEl.value.scrollHeight * (translateY.value / wrpperEl.value.offsetHeight) - 20,\n        behavior: props.behavior,\n      })\n    }\n\n    watchEffect(() => {\n      if (!wrpperEl?.value)\n        return\n\n      isShowBarY.value\n        = wrpperEl.value.offsetHeight < wrpperEl.value.scrollHeight\n      isShowBarX.value\n        = wrpperEl.value.offsetWidth < wrpperEl.value.scrollWidth\n      updateThumb()\n    })\n\n    const onMousedown = (isAxisY: boolean) => {\n      return (evt: MouseEvent) => {\n        if (!wrpperEl.value)\n          return\n\n        let moveStart = 0\n        let currentTranslate = 0\n        const isTrackEl = evt.target !== thumbXEl.value && evt.target !== thumbYEl.value\n\n        if (isAxisY) {\n          currentTranslate = translateY.value\n          moveStart = evt.screenY\n        }\n        else {\n          currentTranslate = translateX.value\n          moveStart = evt.screenX\n        }\n\n        if (isTrackEl) {\n          if (isAxisY) {\n            translateY.value = evt.offsetY - thumbHeight.value / 2\n            return scrollY()\n          }\n          translateX.value = evt.offsetX - thumbWidth.value / 2\n          return scrollX()\n        }\n\n        const movelistener = (evt: MouseEvent) => {\n          if (!wrpperEl.value)\n            return\n\n          const moveEnd = isAxisY ? evt.screenY : evt.screenX\n          if (isAxisY) {\n            translateY.value = Math.max(\n              Math.min(\n                currentTranslate + moveEnd - moveStart,\n                wrpperEl.value.offsetHeight - thumbHeight.value,\n              ),\n              0,\n            )\n            return scrollY()\n          }\n          translateX.value = Math.max(\n            Math.min(\n              currentTranslate + moveEnd - moveStart,\n              wrpperEl.value.offsetWidth - thumbWidth.value,\n            ),\n            0,\n          )\n          return scrollX()\n        }\n\n        const defaultSelectstart = document.onselectstart\n        const clean = () => {\n          document.removeEventListener('mousemove', movelistener)\n          document.removeEventListener('mouseup', clean)\n          document.onselectstart = defaultSelectstart\n        }\n        document.addEventListener('mousemove', movelistener)\n        document.addEventListener('mouseup', clean)\n        document.onselectstart = () => false\n      }\n    }\n\n    const onScroll = (evt: UIEvent) => {\n      const target = evt.target as HTMLElement\n      if (beforeScrollTop !== target.scrollTop) {\n        translateY.value\n          = (target.scrollTop * target.offsetHeight) / target.scrollHeight\n        beforeScrollTop = target.scrollTop\n      }\n      if (beforeScrollLeft !== target.scrollLeft) {\n        translateX.value\n          = (target.scrollLeft * target.offsetWidth) / target.scrollWidth\n        beforeScrollLeft = target.scrollLeft\n      }\n      updateThumb()\n      emit('scroll', evt)\n    }\n\n    const onMouseenter = () => {\n      isShowBar.value = true\n    }\n\n    const onMouseleave = () => {\n      isShowBar.value = false\n    }\n\n    return () => (\n      <div\n        class=\"ch-scrollbar\"\n        style={scrollbarHeight.value}\n        onMouseenter={onMouseenter}\n        onMouseleave={onMouseleave}\n      >\n        <div ref={wrpperEl} class=\"ch-scrollbar-wrpper\" onScroll={onScroll}>\n          {slots.default?.()}\n        </div>\n        <div\n          class=\"ch-scrollbar-bar ch-scrollbar-bar--x\"\n          onMousedown={onMousedown(false)}\n        >\n          <div\n            ref={thumbXEl}\n            v-show={isShowBar.value && isShowBarX.value}\n            class=\"ch-scrollbar-bar-thumb ch-scrollbar-bar-thumb--x\"\n            style={`width: ${thumbWidth.value}px; transform: translateX(${translateX.value}px)`}\n          />\n        </div>\n        <div\n          class=\"ch-scrollbar-bar ch-scrollbar-bar--y\"\n          onMousedown={onMousedown(true)}\n        >\n          <div\n            ref={thumbYEl}\n            v-show={isShowBar.value && isShowBarY.value}\n            class=\"ch-scrollbar-bar-thumb ch-scrollbar-bar-thumb--y\"\n            style={`height: ${thumbHeight.value}px; transform: translateY(${translateY.value}px)`}\n          />\n        </div>\n      </div>\n    )\n  },\n})\n"],"names":["defineComponent","ref","useExpose","computed","watchEffect","evt","_createVNode","_withDirectives","_vShow"],"mappings":"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"}