{"version":3,"file":"index.js","sources":["../../../../../src/components/popover/src/index.tsx"],"sourcesContent":["import type { ExtractPropTypes, PropType } from 'vue'\nimport { Transition, computed, defineComponent, ref, watch, watchEffect } from 'vue'\nimport type { Placement } from '@floating-ui/vue'\nimport { arrow, autoUpdate, flip, inline, offset, shift, useFloating } from '@floating-ui/vue'\nimport { animation, isBoolean } from '../../../utils'\nimport { useOutside } from '../../../composables'\n\nexport type PopoverProps = ExtractPropTypes<typeof popoverProps>\n\nconst popoverProps = {\n  title: String,\n  content: String,\n  placement: {\n    type: String as PropType<Placement>,\n    default: 'right',\n  },\n  trigger: {\n    type: [String, Boolean] as PropType<'hover' | 'click' | boolean>,\n    default: 'hover',\n  },\n}\n\nexport default defineComponent({\n  name: 'Popover',\n  props: popoverProps,\n  setup(props, { slots }) {\n    let flag = true\n    let timer: NodeJS.Timeout\n    const popperPlacement = ref('')\n    const visible = ref(false)\n    const reference = ref<HTMLElement>()\n    const popover = ref<HTMLElement>()\n    const popoverArrow = ref<HTMLElement>()\n    const popoverContainer = ref<HTMLElement>()\n\n    const { floatingStyles, middlewareData, placement } = useFloating(reference, popover, {\n      placement: props.placement,\n      middleware: [\n        inline(),\n        offset(8),\n        flip(),\n        shift({ crossAxis: true }),\n        arrow({ element: popoverArrow }),\n      ],\n      whileElementsMounted(...args) {\n        const cleanup = autoUpdate(...args, { animationFrame: true })\n        return cleanup\n      },\n    })\n\n    const style = computed(() => {\n      return Object.assign(floatingStyles.value, {\n        width: '100%',\n        zIndex: 999,\n      })\n    })\n\n    watchEffect(() => {\n      if (isBoolean(props.trigger))\n        visible.value = props.trigger\n    })\n\n    watch(middlewareData, () => {\n      if (middlewareData.value.arrow && popoverContainer.value && popoverArrow.value) {\n        const { x, y } = middlewareData.value.arrow\n\n        let arrowPlacement = {}\n        switch (placement.value) {\n          case 'top':\n            popperPlacement.value = placement.value\n            arrowPlacement = { bottom: '-4px' }\n            break\n          case 'bottom':\n            popperPlacement.value = placement.value\n            arrowPlacement = { top: '-4px' }\n            break\n          case 'left':\n            popperPlacement.value = placement.value\n            arrowPlacement = { right: '-4px' }\n            break\n          case 'right':\n            popperPlacement.value = placement.value\n            arrowPlacement = { left: '-4px' }\n            break\n          default:\n            break\n        }\n        Object.assign(popoverArrow.value.style, {\n          left: x != null ? `${x}px` : '',\n          top: y != null ? `${y}px` : '',\n          ...arrowPlacement,\n        })\n      }\n    })\n\n    const onClick = () => {\n      if (!isBoolean(props.trigger) && !visible.value)\n        visible.value = true\n    }\n\n    const onMouseenter = () => {\n      flag = false\n      visible.value = true\n    }\n\n    const onMouseleave = () => {\n      flag = true\n      timer = setTimeout(() => {\n        clearTimeout(timer)\n        visible.value = !flag\n      }, 300)\n    }\n\n    const onReferenceClick = (evt: MouseEvent) => {\n      if (props.trigger === 'click') {\n        evt.stopPropagation()\n        visible.value = !visible.value\n      }\n    }\n\n    const eventProps = computed(() => {\n      if (props.trigger === 'hover') {\n        return {\n          onMouseenter,\n          onMouseleave,\n        }\n      }\n      const { isOutside } = useOutside(popoverContainer, visible)\n      watchEffect(() => isOutside.value && (visible.value = false))\n      return {\n        onClick,\n      }\n    })\n\n    const renderPopover = () => (\n      <>\n        <div>{props.title}</div>\n        <div>{props.content}</div>\n      </>\n    )\n\n    return () => (\n      <div\n        style='position: relative'\n        ref={popoverContainer}\n        {...eventProps.value}\n      >\n        <Transition\n          enter-active-class={animation('fadeIn')}\n          leave-active-class={animation('fadeOut')}\n          appear\n        >\n          {visible.value && <div\n            id=\"ch-popover\"\n            ref={popover}\n            style={style.value}\n            data-popper-placement={popperPlacement.value}\n            class={!slots.headless && 'ch-popover-content'}\n          >\n            {slots.headless?.() || slots.default?.() || renderPopover()}\n            {\n              slots.headless\n                ? null\n                : <div\n                    id=\"ch-popover-arrow\"\n                    ref={popoverArrow}\n                    data-popper-arrow\n                  />\n            }\n          </div>}\n        </Transition>\n        <div\n          class='ch-popover-reference'\n          ref={reference}\n          onClick={onReferenceClick}\n        >\n          {slots.reference?.()}\n        </div>\n      </div>\n    )\n  },\n})\n"],"names":["defineComponent","ref","useFloating","inline","offset","flip","shift","arrow","autoUpdate","computed","watchEffect","isBoolean","watch","useOutside","_createVNode","_Fragment","_mergeProps","Transition","animation","_a"],"mappings":"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"}