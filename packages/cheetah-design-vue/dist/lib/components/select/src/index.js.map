{"version":3,"file":"index.js","sources":["../../../../../src/components/select/src/index.tsx"],"sourcesContent":["import type { StyleValue } from 'vue'\nimport { computed, defineComponent, ref, watch, watchEffect } from 'vue'\nimport Input from '../../input'\nimport Dropdown from '../../dropdown'\nimport { useExpose, useOutside } from '../../../composables'\nimport Tag from '../../tag'\nimport { unrepeatObjectArray } from '../../../utils'\nimport type { SelectOption } from './select'\nimport { selectProps } from './select'\n\nexport default defineComponent({\n  name: 'Select',\n  props: selectProps,\n  emits: ['update:modelValue'],\n  setup(props, { slots }) {\n    const visible = ref(false)\n    const inputValue = ref('')\n    const selectEl = ref<HTMLElement>()\n    const crrentValue = ref<SelectOption>()\n    const selectValue = ref<SelectOption[]>([])\n\n    useExpose({\n      selectValue,\n    })\n\n    const { isOutside } = useOutside(selectEl, visible)\n    watchEffect(() => isOutside.value && (visible.value = false))\n\n    watch(inputValue, (value) => {\n      if (!value)\n        selectValue.value.length = 0\n    })\n\n    const onSelectClick = () => {\n      visible.value = true\n    }\n\n    const onSelectOptionClick = (option: SelectOption) => {\n      if (props.multiple) {\n        selectValue.value.push(option)\n        selectValue.value = unrepeatObjectArray(selectValue.value, 'name')\n        inputValue.value = selectValue.value.map(option => option.name).join()\n      }\n      else {\n        selectValue.value = [option]\n        inputValue.value = option.name\n      }\n    }\n\n    const onTagClose = (index: number) => {\n      return (evt: MouseEvent) => {\n        evt.stopPropagation()\n        selectValue.value.splice(index, 1)\n        inputValue.value = selectValue.value.map(option => option.name).join()\n      }\n    }\n\n    const resolveProps = ref({\n      mode: props.mode,\n      size: props.size,\n      infoTip: props.infoTip,\n      prefixIcon: props.prefixIcon,\n      suffixIcon: props.suffixIcon,\n      placeholder: props.placeholder,\n      disabled: props.disabled,\n      clearable: props.clearable,\n    })\n\n    const resolveSlots = computed(() => {\n      if (!props.multiple)\n        return slots\n\n      const wrapperStyle = {\n        display: 'inline-flex',\n        alignItems: 'center',\n        flexWrap: 'wrap',\n        padding: '5px 10px',\n        gap: '5px',\n        width: '100%',\n        height: '100%',\n        cursor: 'pointer',\n      } as StyleValue\n\n      const placeholderStyle = {\n        color: 'var(--ch-input-ph-text-color)',\n      }\n\n      return {\n        ...slots,\n        selectWrapper() {\n          return (\n            <div style={wrapperStyle}>\n              <div v-show={!selectValue.value.length && props.placeholder} style={placeholderStyle}>\n                {props.placeholder}\n              </div>\n              {\n                selectValue.value.map((option, index) => (\n                  <Tag\n                    mode='outline'\n                    state='info'\n                    closable\n                    onClose={onTagClose(index)}\n                  >\n                    {option.name}\n                  </Tag>\n                ))\n              }\n            </div>\n          )\n        },\n      }\n    })\n\n    return () => (\n      <Dropdown\n        trigger={visible.value}\n        data={props.options}\n        v-model={crrentValue.value}\n        onClick={onSelectOptionClick}\n        v-slots={{\n          reference() {\n            return (\n              <div ref={selectEl} onClick={onSelectClick}>\n                <Input\n                  {...resolveProps.value}\n                  v-model={inputValue.value}\n                  v-slots={resolveSlots.value}\n                  suffix-icon='chevron-down'\n                />\n              </div>\n            )\n          },\n        }}\n      />\n    )\n  },\n})\n"],"names":["defineComponent","selectProps","ref","useExpose","useOutside","watchEffect","watch","unrepeatObjectArray","option","index","computed","_createVNode","_withDirectives","_vShow","Tag","Dropdown","Input","_mergeProps"],"mappings":"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"}